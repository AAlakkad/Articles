[TOC]
# مقدمة في تطوير قوالب ووردبريس - الجزء الثاني

تعرفنا في الدرس الماضي على كيفية البدء بتحويل قالب HTML إلى قالب ووردبريس (WordPress) ورأينا كيف يتم استخدام التسلسل الهرمي لملفات القالب، ثم أضفنا عليه بعض الوسوم لإظهار المقالات من قاعدة البيانات.

في هذا الدرس نقوم بإظهار أرقام الصفحات في الصفحة الرئيسية عندما يكون عدد المقالات في المدونة أكبر من عدد المقالات التي يتم إظهارها في الصفحة الرئيسية.

ونتعرّف على كيفية استخدام أجزاء القالب (Template Parts) لإظهار أرقام الصفحات في الصفحة الرئيسية (index.php) أو في غيرها إن دعت الحاجة.

## استخدام أجزاء القالب (Template Parts)

أجزاء القالب من الأمور الهامة أثناء تطوير قوالب ووردبريس، تأتي أهميتها في الحثّ على عدم التكرار وإعادة الاستخدام.
فمثلاً تحتاجُ في القالب لوضع أزرار المشاركة في عدد من الأماكن، فبدلاً من أن يتم النسخ واللصق لاستعمال الأزرار في عدد من الأمكنة، يتم استخدام أجزاء القالب، ثم استدعاء الجزء المطلوب بجملة واحدة.
بهذا نقلل من حجم الكود، ونختصر من الوقت المطلوب لإجراء التعديل على هذه الأجزاء، وبالتالي نقلل من الأخطاء المحتملة قدر الإمكان.

استخدام أجزاء القالب بسيط، يتألف من قسمين:
- القسم الأول هو كيفية تسمية الملفات (الأجزاء) بطريقة تسمح للدّالّة بإيجاد الملف.
- القسم الثاني هو استخدام الدّالّة لاستدعاء الملف المطلوب ضمن وسوم الصفحة.

### استخدام دالّة استدعاء الملف

نقوم باستخدام دالة [`get_template_part()`](http://codex.wordpress.org/Function_Reference/get_template_part) لطلب الملف الذي نريده، نمرر للدّالة اسم الملف المطلوب بالطريقة التالي:
```php
<?php
get_template_part('sharing');
?>
```
في هذه الحالة يكون اسم الملف: `sharing.php` موجود بجوار ملف `index.php` وباقي ملفات القالب.

تعمل الدّالة بشكل مشابه لدالّة [`include`](http://php.net/manual/en/function.include.php) الشهيرة ضمن لغة PHP.

فلو وضعنا ضمن ملف `sharing.php` أيَّ محتوىً سواء كان وسوم HTML أو PHP فإنه سيتم عرضه أو تنفيذه في المكان الذي استخدمنا فيه دالّة `get_template_part`.

### طريقة تسمية أجزاء القالب

سنعرض بضعة أمثلة نستشكف من خلالها كيفية وضع أسماء الملفات مع كيفية استدعاءها عن طريق الدّالّة:

اسم الملف: `pagination.php`
طريقة الاستدعاء: `<?php get_template_part('pagination');?>`

اسم الملف: `pagination.php` داخل مجلد `parts`
طريقة الاستدعاء: `<?php get_template_part('parts/pagination');?>`

اسم الملف: `pagination-posts.php`
طريقة الاستدعاء: `<?php get_template_part('pagination', 'posts');?>`

اسم الملف: `pagination-posts.php` داخل مجلد `parts`
طريقة الاستدعاء: `<?php get_template_part('parts/pagination', 'parts');?>`

#### تسمية الملفات وتمرير المحددات
- نقوم بتمرير اسم الملف إلى الدّالّة بدون لاحقة الملف `.php`.
- المحدّد الثاني للدّالّة هو الجزء الثاني من اسم الملف، الجزء الذي يأتي بعد إشارة `-`.
- في حال كان الملف داخل مجلد، نقوم بوضع المسار قبل اسم الملف.



## إضافة مقالات متنوعة لتجربة القالب

سنقوم باستخدام [الملف](https://wpcom-themes.svn.automattic.com/demo/theme-unit-test-data.xml) المقدم [لمطوّري ووردبريس](http://codex.wordpress.org/Theme_Unit_Test) الذي يحوي مقالات "شكليّة" متنوعة، هدفها رؤية شكل القالب بوجود عدة أشكال من المقالات.

- بعد تنصيب الملف، نتوجه من لوحة التحكم إلى "أدوات" ثم "استيراد"، بعد ذلك نختار "WordPress" فتظهر لنا نافذة تنصيب إضافة الاستيراد.
- نقوم بتفعيل الإضافة التي قمنا بتنصيبها.
- تظهر لنا صفحة الإضافة لاستيراد ملف `xml` الذي قمنا بتحميله منذ قليل.
- نختار الملف، ثم نضغط زر "ارفع الملف واستورده"
- تظهر لنا صفحة فيها عدد من الخيارات لإنشاء مستخدمين جدد وفي آخرها خيار " Download and import file attachments"، يمكن أن نترك حقول المستخدمين فارغة. لكن نضغط الخيار السابق لتحميل الصور الخاصة بالمقالات.
- نضغط زر submit وننتظر قليلاً ريثما يتم استيراد المقالات وتحميل الصور.


## إضافة أرقام الصفحات *
يوجد عدة طرق لعرض أرقام الصفحات بطريقة تناسب شكل القالب الذي نقوم باستخدامه (تناسب كيفية عمل أرقام الصفحات في إطاري عمل [Bootstrap](http://getbootstrap.com) و [Foundation](http://foundation.zurb.com/)).

- إما نقوم بنسخ دالّة [`paginate_links()`](http://codex.wordpress.org/Function_Reference/paginate_links) المسؤولة عن عرض أرقام الصفحات ونعدّل عليها حسب المطلوب، وذلك في ملف `functions.php` داخل ملفات قالب ووردبريس.
- أو نقوم بإنشاء دالّة جديدة تحاكي مبدأ عمل دالّة `paginate_links()` لكن بخيارات أقل حسب ما يتطلبه القالب.
- أو نقوم باستخدام إضافة [WP-PageNavi](https://wordpress.org/plugins/wp-pagenavi/) التي تعمل بطريقة مشابهة لدالّة `paginate_links()` لكن مع المزيد من الخيارات، منها إمكانية التحكم بالوسوم عن طريق ما يسمّى [Filters](http://codex.wordpress.org/Plugin_API/Filter_Reference).

يمكن استخدام الطريقة الأخيرة عندما نتحدث عن Actions/Filters، لكن في هذا الدرس سنستخدم الطريقة الأولى.

ضمن ملفات التوثيق الخاصّة بدالّة `paginate_links` نجد في النهاية [رابطاً](https://core.trac.wordpress.org/browser/tags/4.1/src/wp-includes/general-template.php#L2587) للوصول إلى الشيفرة المصدرية لووردبريس، تحديداً إلى مكان تعريف تلك الدالّة.

سنقوم بنسخ هذه الدالّة كاملة ونضعها في ملف `functions.php` ضمن القالب الذي نعمل عليه. نعيد تسمية الدالّة المنسوخة لتصبح مثلاً `my_paginate_links` كي لا يحدث خطأ أثناء الاستخدام بسبب تعريف الدالّة مرة ثانية إن بقيت بنفس الاسم الأصلي.

الخطوة الأولى أن نقوم بالاستغناء عن خاصيّة **type** ضمن مصفوفة `$args`، ﻷننا سنفرض أننا نستخدم دوماً النوع *list*.

نقوم بتعديل ما يلي، حيث إشارة `-` في بداية السطر تشير إلى حذف السطر، وإشارة `+` تشير إلى الإضافة:
```diff
-                'type' => 'plain',
```
```diff
-        switch ( $args['type'] ) {
-                case 'array' :
-                        return $page_links;
-
-                case 'list' :
-                        $r .= "<ul class='pagination'>\n\t<li>";
-                        $r .= join("</li>\n\t<li>", $page_links);
-                        $r .= "</li>\n</ul>\n";
-                        break;
-
-                default :
-                        $r = join("\n", $page_links);
-                        break;
-        }
+        $r .= "<ul class='pagination'>\n\t<li>";
+        $r .= join("</li>\n\t<li>", $page_links);
+        $r .= "</li>\n</ul>\n";
```

ثم نقوم بحذف وسوم `</li><li>` من نهاية الدالّة:
3bf6b1b
```diff
-        $r .= "<ul class='pagination'>\n\t<li>";
-        $r .= join("</li>\n\t<li>", $page_links);
-        $r .= "</li>\n</ul>\n";
+        $r .= "<ul class='pagination'>\n\t";
+        $r .= join("\n\t", $page_links);
+        $r .= "\n</ul>\n";
```

وأخيراً نضع وسوم `<li>` لتحيط بكل رابط `<a>` مع وضع صنف CSS المناسب.
8d10155
```diff
-                $page_links[] = '<a class="prev arrow" href="' . esc_url( apply_filters( 'paginate_links', $link ) ) . '">' . $args['p
+                $page_links[] = '<li class="prev arrow"><a href="' . esc_url( apply_filters( 'paginate_links', $link ) ) . '">' . $arg
         endif;
         for ( $n = 1; $n <= $total; $n++ ) :
                 if ( $n == $current ) :
-                        $page_links[] = "<a class='current'>" . $args['before_page_number'] . number_format_i18n( $n ) . $args['after_
+                        $page_links[] = "<li class='current'><a href=''>" . $args['before_page_number'] . number_format_i18n( $n ) . $
                         $dots = true;
                 else :
                         if ( $args['show_all'] || ( $n <= $end_size || ( $current && $n >= $current - $mid_size && $n <= $current + $m
@@ -90,10 +90,10 @@ function my_paginate_links( $args = '' ) {
                                 $link .= $args['add_fragment'];
 
                                 /** This filter is documented in wp-includes/general-template.php */
-                                $page_links[] = "<a href='" . esc_url( apply_filters( 'paginate_links', $link ) ) . "'>" . $args['befo
+                                $page_links[] = "<li><a href='" . esc_url( apply_filters( 'paginate_links', $link ) ) . "'>" . $args['
                                 $dots = true;
                         elseif ( $dots && ! $args['show_all'] ) :
-                                $page_links[] = '<span class="dots">' . __( '&hellip;' ) . '</span>';
+                                $page_links[] = '<li class="unavailable"><a href="">'. __( '&hellip;' ) .'</a></li>';
                                 $dots = false;
                         endif;
                 endif;
@@ -106,7 +106,7 @@ function my_paginate_links( $args = '' ) {
                 $link .= $args['add_fragment'];
 
                 /** This filter is documented in wp-includes/general-template.php */
-                $page_links[] = '<a class="next arrow" href="' . esc_url( apply_filters( 'paginate_links', $link ) ) . '">' . $args['n
+                $page_links[] = '<li class="arrow"><a href="' . esc_url( apply_filters( 'paginate_links', $link ) ) . '">' . $args['ne
         endif;
```

يمكن الآن أن نستخدم الدالّة الجديدة كما يلي في ملف `index.php`:
0bec5b7
```php
<?= my_paginate_links(); ?>
```


## إمكانية ارفاق صورة لكل مقال **
ربما لاحظت أثناء إضافة المقالات أنه لا يوجد مكان لإضافة الصورة المميزة (featured image)، وهذا صحيح، فمن أجل إظهار الصورة نستخدم ما يُسمّى **دعم القالب** (Theme Support)، ويعني أن تتعرف ووردبريس عن طريق هذا الاستخدام إلى أن القالب الفعّال يسمح بدعم خصائص معينة ويستطيع معالجتها.
لإضافة هذه الإمكانية نضع ما يلي ضمن ملف `functions.php` في ملفات القالب:
```php
add_theme_support('post-thumbnails');
```

بعد ذلك في صفحة إضافة المقال جديد وجود صندوق صغير مخصص لإضافة الصورة المميزة.

### حجم الصور المميزة **

توفّر ووردبريس للمطوّرين 3 أحجام جاهزة لكل صورة مميزة، يتم إنشاء هذه الحجوم بشكل تلقائي دون أي تدخّل برمجيّ من المطوّر.

لاستخدام أحد مقاسات الصورة في القالب:
```php
<?php the_post_thumbnail( 'medium'); ?>
?>
```
يمكن أن نضع مكان معرّف القياس (في المثال السابق هو `medium`)، يمكن أن نضع أي معرّف من المعرفات المدمجة مع ووردبريس، وهي:
thumbnail - 150 - 150
medium - 300 - 300
large - 640 - 640
full - القياسات الأصلية كما تم رفعها

يمكن أيضاً تمرير مصفوفة بدل اسم المعرف تحوي عنصرين هما العرض والطول، كما يلي:
```php
the_post_thumbnail(array(100, 100));
```

### إضافة حجوم مخصصة للصورة المميزة *

عند عرض الصورة المميزة في الشريط الجانبي، لا ينبغي أن نعرض الصورة بحجمها الطبيعي، فلو كانت الصورة بأبعاد 800\*600 فلا ينبغي تصغيرها عن طريق وسوم HTML أو خصائص CSS من أجل جعل مقاسها 80\*60 مثلاً ليتم عرضها في الشريط الجانبي.

ماذا لو لم تتناسب الحجوم الجاهزة للصور المميزة مع القالب الذي نقوم بإنشاءه؟

تقدّم ووردبريس خياراً لإضافة حجوم مخصصة للصور المميزة، فيتمكّن المطور من إضافة الحجم الأنسب للقالب الذي يقوم بصنعه. ليعرض الصورة دون أي تصغير أو تكبير لها عن طريق HTML أو CSS.

لتعريف حجم جديد نستخدم دالّة `add_image_size()`، والتي يجب أن يتم تزويدها بمحددّين على الأقل، هم المعرّف (اسم مميز ليتم استخدام القياس عن طريقه) وعرض الصورة.

مثال:
```php
add_image_size('my_custom_size', 540);
```

في هذه الحالة، تقوم ووردبريس بجعل العرض كما هو محدد أثناء التعريف، ويكون الطول متناسباً مع أبعاد الصورة الأصلية، كي لا يحدث تغير في نسبة الأبعاد وبالتالي تشويه للصورة.

**بحاجة لمراجعة:** *هناك محددان إضافيات يمكن استخدمهمها، الطول، لإجبار طول معين بالإضافة للعرض المحدد. والأخير هو لتحديد إذا ما نريد اقتصاص الصورة إن تجاوزت الطول والعرض المحددين أو لا.*

## إضافة القائمة الرئيسية **

يمكن إضافة العناصر للقائمة عن طريق لوحة التحكم ثم المظهر ثم القوائم.

## التعليقات **
### تجهيز صفحة المقال single.php
### إضافة ملف التعليقات

