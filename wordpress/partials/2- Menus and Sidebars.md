[TOC]
# قوائم التنقّل

قوائم التنقّل (Navigation Menu) هي إحدى ميزات القوالب، توفّر ووردبريس طريقة سهلة للتحكم بالقوائم المخصصة للقالب من داخل لوحة تحكم ووردبريس، فتحتاج لإضافة بضعة أسطر برمجية لتضيف دعم القوائم في قالبك.

## تسجيل القوائم

بدايةً في ملف `functions.php` ضمن ملفات القالب نحتاج لإضافة دالّة تقوم بتسجيل أسماء القائمة (أو القوائم) التي تريد إضافتها. كالتالي:
```php
add_action('init', function() {
	register_nav_menu('our-custom-menu', 'القائمة الرئيسية');
});
```

بعد ذلك يمكن التأكد من صحة إضافة القائمة عن طريق الذهاب من لوحة التحكم إلى المظهر (Appearance) ثم القوائم (Menus)، ستظهر لدينا قائمة باسم **القائمة الرئيسية** في تبويب *إدارة موضع القوائم*.
تأخذ دالّة [`register_nav_menu`](http://codex.wordpress.org/Function_Reference/register_nav_menu) محدّدين هما: المكان (Location) و الوصف (Description).

محدّد المكان يستخدم كمعرّف للقائمة، حيث يتم طلب محتوى القائمة ضمن ملفات القالب عن طريق محدّد المكان (location) الذي قمنا بتعيينه أثناء تسجيل القائمة. في حالتنا قمنا بوضع قيمة المحدد هي: **our-custom-menu**.
والوصف يتم استخدامه عند عرض القائمة في لوحة التحكم ليكون أنسب وأسهل للقراءة من محدد المكان، في حالتنا قمنا بوضع قيمة الوصف هي: **القائمة الرئيسية**.

يمكننا تسجيل أكثر من قائمة معاً عن طريق استخدام دالّة [`register_nav_menus`](http://codex.wordpress.org/Function_Reference/register_nav_menus) التي تستخدم بشكل مشابه لدالّة `register_nav_menu` لكن المحدّدات تكون على شكل مصفوفة اسميّة (Associative Array)، كل عنصر في المصفوفة يمثّل قائمة واحدة بحيث يكون مفتاح العنصر هو محدّد المكان وقيمة العنصر هي محدّد الوصف.

في قالبنا لا نحتاج سوى لقائمة واحدة، في ما يلي كيفية تسجيل أكثر من قائمة معاً:
```php
add_action('init', function() {
	register_nav_menus([
		'our-custom-menu' => 'القائمة الرئيسية',
		'our-second-menu' => 'القائمة الفرعية',
	]);
});
```

كما ننوه إلى وجود دالّة معاكسة لدالّة تسجيل القوائم هي [`unregister_nav_menu`](http://codex.wordpress.org/Function_Reference/unregister_nav_menu) لكننا لن نتطرّق إليها الآن.

## إظهار القائمة في القالب
الخطوة الأخيرة ضمن القالب هي عرضه في المكان المناسب.
في القالب الذي نستعمله نجد أن موقع القوائم أصبح في ملف `header.php`، في السطر 30 من الملف نجد وسم `<section class="top-bar-section">`، نريد أن نضع القائمة بدلاً من وسم `<ul>` الموجود بداخله.

نقوم بحذف وسم `<ul>` مع محتواه، ثم نستخدم السطر البرمجيّ التالي لعرض القائمة:
```php
<?php wp_nav_menu(['theme_location' => 'our-custom-menu']); ?>
```

تقبل دالّة `wp_nav_menu` محدداً واحداً هو مصفوفة تحوي عدداً من الإعدادات، الإعداد الوحيد الضروري هو `theme_location` ويتم استخدامه كما في السطر البرمجي السابق. يمثل هذا المحدّد قيمة محدّد المكان السابقة التي استخدمناها أثناء تسجيل قائمة جديدة والتي كانت: `our-custom-menu`.
في حال لم يتم إدخال هذا المحدّد تقوم ووردبريس باستخدام قيمة إعداد `menu` (سنأتي إليه في الفقرة التالية)، وإن لم تجد قيمة فسيتم عرض أول قائمة غير فارغة تجدها ووردبريس، وفي حال عدم وجود أي قوائم غير فارغة وعدم تمرير محدّد المكان فلا يتم عرض شيء.

إن ألقينا نظرة على القالب من المتصفح سنجد أن شكل عناصر القائمة أصبح مختلف قليلاً عن الشكل الذي كان عليه، وذلك ﻷن الدالّة تقوم بإضافة وسم `<div>` محيط بوسوم القائمة.

في الفقرة التالية سنتعرف على بقية الإعدادات التي يمكن أن نستخدمها مع دالّة `wp_nav_menu` والتي ستمكننا من إظهار القائمة على الشكل الأنسب.

## إعدادات دالّة `wp_nav_menu`
كما قلنا من قبل فإن دالّة `wp_nav_menu` تأخذ محدّداً واحداً هو مصفوفة تحوي مجموعة إعدادات، المبرمج ليس مضطراً لإدخال جميع الإعدادات، يمكنه إدخال بعضها والباقي ستقوم ووردبريس بمعالجته وإسناد قيمته الافتراضية. الإعدادات بشكل كامل هي:

```php
<?php
$defaults = array(
	'theme_location'  => '',
	'menu'            => '',
	'container'       => 'div',
	'container_class' => '',
	'container_id'    => '',
	'menu_class'      => 'menu',
	'menu_id'         => '',
	'echo'            => true,
	'fallback_cb'     => 'wp_page_menu',
	'before'          => '',
	'after'           => '',
	'link_before'     => '',
	'link_after'      => '',
	'items_wrap'      => '<ul id="%1$s" class="%2$s">%3$s</ul>',
	'depth'           => 0,
	'walker'          => ''
);

wp_nav_menu( $defaults );

?>
```
- theme_location
مكان القائمة ضمن القالب، كما تم تحديده أثناء تسجيل القائمة باستخدام دالّة `register_nav_menu`، ليكون بإمكان المستخدم تحديد القائمة المطلوبة للمكان الذي تم تسجيله (دون تقييد المستخدم بقائمة واحدة).
القيمة الافتراضية: '' (سلسلة نصية فارغة)
- menu
القائمة المطلوب عرضها، تقبل قيمة المعرّف الرقمي (ID)، أو الاسم اللطيف (slug)، أو الاسم الخاص بالقائمة (وليس مكان القائمة ضمن القالب).
القيمة الافتراضية: '' (سلسلة نصية فارغة)
- container
لتحديد إن كان مطلوباً من ووردبريس إحاطة وسم `<ul>` بوسم آخر أم لا، القيمة المسموحة هي `div` أو `nav`، وفي حال عدم الرغبة بإحاطة القائمة بوسم نجعل القيمة `false`.
القيمة الافتراضية: 'div'
- container_class
الصنف الخاص بوسم html المحيط بالقائمة، بشكل افتراضي يأخذ الصنف الشكل: `menu-{menu slug}-container` حيث يكون `{menu slug}` هو الاسم اللطيف للقائمة.
القيمة الافتراضية: '' (سلسلة نصية فارغة)
- container_id
معرّف CSS (ID) الذي يتم تطبيقه على الوسم المحيط (container).
القيمة الافتراضية: '' (سلسلة نصية فارغة)
- menu_class
الصنف الذي يتم تطبيقه على وسم القائمة `<ul>`، يمكن أن يتم وضع أكثر من صنف يتم الفصل بينهم بفراغات (space).
القيمة الافتراضية: 'menu'
- menu_id
معرّف (ID)  CSS الذي يتم تطبيقه على وسم القائمة `<ul>`. بشكل افتراضي تكون قيمته: `menu-{menu slug}` حيث `{menu slug}` هو الاسم اللطيف للقائمة؛ في حال حدوث تكرار بالاسم يتم إضافة إشارة `-` مع رقم مميز يبدأ من 1 ويزيد عند كل تكرار، مثلاً: `menu-{menu slug}-1`، `menu-{menu slug}-2`، إلخ.
القيمة الافتراضية: '' (سلسلة نصية فارغة)
- echo
فيما إن كنا نريد إظهار القائمة مباشرة في مكان استخدام دالّة `wp_nav_menu` أو نريد إرجاعها (return).
القيمة الافتراضية: true
- fallback_cb
دالّة ليتم استخدامها في حال لم تكن القائمة موجودة، نضع قيمتها `false` في حال لم نكن نريد استخدام دالّة. ويتم تمرير محدّد `$args` للدالّة التي يتم استخدامها.
القيمة الافتراضية: 'wp_page_menu'
- before
إظهار نصّ قبل وسم `<a>`.
القيمة الافتراضية: '' (سلسلة نصية فارغة)
- after
إظهار نصّ بعد وسم `</a>`.
القيمة الافتراضية: '' (سلسلة نصية فارغة)
- link_before
إظهار نصّ قبل نصّ الرابط.
القيمة الافتراضية: '' (سلسلة نصية فارغة)
- link_after
إظهار نصّ بعد نصّ الرابط.
القيمة الافتراضية: '' (سلسلة نصية فارغة)
- items_wrap
يتم تفسيرها بنفس الطريقة التي يتم تفسير محدّد الهيئة (format) لدالّة [`sprintf`](http://php.net/sprintf).
يحدث تعاون بين المحددات الأخرى عن طريق رموز رقمية. `%1$s` تُستبدل بقيمة محدد `menu_id`، `%2$s` تُستبدل بقيمة محدد `menu_class`، و `%3$s` تُستبدل بقيمة عناصر القائمة (وسوم `<li>`).
إن تم استبعاد أي رمز رقمي من هذا المحدّد، سيتم استبعاد المحدّد المرتبط به من وسوم القائمة.
القيمة الافتراضية: `'<ul id="%1$s" class="%2$s">%3$s</ul>'`
- depth
يمثل عدد المستويات الهرمية التي سيتم استخدامها، حيث رقم `0` يعني جميع المستويات. ويتم استخدام قيمة `-1` لتحويل جميع المستويات إلى مستوى واحد فقط.
القيمة الافتراضية: 0
- walker
يتم تمرير عنصر هو نسخة من صنف `Walker_Nav_Menu` أو من صنف يرث من ذلك الصنف.
الهدف من هذا المحدد هو التحكم بشكل كامل بالأصناف (classes) والمحدّدات (IDs) ووسوم HTML للقائمة. *يمكن العودة [لتوثيق WordPress](http://codex.wordpress.org/Function_Reference/wp_nav_menu#Using_a_Custom_Walker_Function) للاطلاع على المثال المتقدم*
القيمة الافتراضية: '' (سلسلة نصية فارغة)

## تحسين ظهور القائمة في القالب

بعد أن تعرّفنا على إعدادات إظهار القائمة، دعونا نقوم بتعديلها في قالبنا لتصبح مناسبة أكثر.
إن شاهدنا مصدر HTML للصفحة الرئيسية من المتصفح، نجد أننا نحتاج لإزالة الوسم المحيط بالقائمة (container)، ونحتاج لإضافة صنف `right` لوسم `<ul>` المحيط بعناصر القائمة.

يمكننا تعديل السطر البرمجي في ملف `header.php` ليصبح:
```php
<?php wp_nav_menu([
	'theme_location' => 'our-custom-menu',
	'container' => false,
	'menu_class' => 'right',
]); ?>
```

قمنا بجعل قيمة الوسم المحيط (container) تساوي `false` ﻷننا لا نريد إحاطة القائمة بأي وسم، فنحن من البداية نقوم بإحاطة القائمة بوسم `<section>` في قالب HTML الذي نستخدمه.
وقمنا أيضاً بإضافة قيمة محدد `menu_class` لتساوي: `right`، ليتم إضافة صنف `right` لوسم القائمة `<ul>` ليظهر بشكل جيّد.

بهذا نكون قد جعلنا القائمة تظهر بشكل مرن، ونعطي المستخدم إمكانية أكبر لاختيار ما يناسبه من عناصر للقائمة من خلال لوحة التحكم، وبنفس الوقت جعلنا القائمة التي يختارها المستخدم تظهر بأفضل شكل ضمن القالب الذي نعمل عليه.

---


# الشريط الجانبي

الأشرطة الجانبية (Sidebars) هي إحدى ميزات القوالب، هو بشكل بسيط عمود شاقولي يقوم القالب بتزويده لعرض معلومات مختلفة عن المحتوى الأساسي للموقع، تقوم الأشرطة الجانبية بعرض ودجات/مربعات (widgets) يقوم مدير المدونة بالتحكم بها.

التعامل مع الشريط الجانبي يشبه إلى حدّ كبير التعامل مع القوائم.

## تسجيل شريط جانبي

لنقم معاً بإضافة ما يلي إلى ملف `functions.php` لتعريف شريط جانبيّ جديد:
```php
add_action('widgets_init', function() {
	register_sidebar();
});
```

إن قمنا بزيارة لوحة التحكم، نجد أن هناك عنصراً جديداً في قائمة المظهر (Appearance) هو الودجات (Widgets)، بداخله يظهر لنا الشريط الجانبي الجديد بعنوان **الشريط الجانبي 1**، إن قمنا بإضافة شريط جانبي آخر سيأخذ نفس الاسم لكن بزيادة الرقم بمقدار واحد. والسبب أننا عندما قمنا بتسجيل الشريط الجانبي لم نحدد له اسماً أو معرّفاً. سنقوم بهذا الآن بعد أن نتعرف على إعدادات هذه الدالّة.

## إعدادات دالّة `register_sidebar`
الإعدادات الافتراضية:
```php
$args = array(
	'name'          => sprintf( __( 'Sidebar %d' ), $i ),
	'id'            => "sidebar-$i",
	'description'   => '',
	'class'         => '',
	'before_widget' => '<li id="%1$s" class="widget %2$s">',
	'after_widget'  => "</li>\n",
	'before_title'  => '<h2 class="widgettitle">',
	'after_title'   => "</h2>\n",
);
```

شرح الإعدادات:

- name
اسم الشريط الجانبي (القيمة الافتراضية هي ترجمة كلمة 'Sidebar' مع معرّف رقميّ).
- id
معرّف الشريط الجانبي - يجب أن يكون بأحرف صغيرة (lowercase), دون فراغات (القيمة الافتراضية هي معرّف رقمية يتم زيادته تلقائياً ).
- description
وصف نصّي لماهيّة/مكان الشريط الجانبي. يظهر في واجهة إدارجة الودجات في لوحة التحكم. (القيمة الافتراضية: فارغة)
- class
صنف CSS ليتم إسناده للشريط الجانبي في صفحة إدارة الودجات، ولن يتم استخدام هذا الصنف  في القالب.
*ملاحظة:* سيتم إضافة كلمة "sidebar" إلى قيمة الصنف. مثلاً: إن وضعنا اسم الصنف: **tal** ستكون قيمة الصنف هي: **sidebar-tal**. (القيمة الافتراضية: فارغة).
- before_widget
وسم/وسوم HTML ليتم وضعها قبل كل واحد من الودجات (widget) (القيمة الافتراضية: '`<li id="%1$s" class="widget %2$s">`').
*ملاحظة:* يتم استخدام دالّة `sprintf` لاستبدال المتحولات.
- after_widget
وسم/وسوم HTML ليتم وضعها بعد كل واحد من الودجات (widget) (القيمة الافتراضية: "</li>\n").
- before_title
وسم/وسوم HTML ليتم وضعها قبل كل عنوان (القيمة الافتراضية: `<h2 class="widgettitle">`).
- after_title
وسم/وسوم HTML ليتم وضعها بعد كل عنوان (القيمة الافتراضية: "`</h2>\n`").


## عرض الشريط الجانبي في القالب

نتوجه إلى ملف `sidebar.php`، ونقوم بتعديله ليصبح كالتالي:
```html
<div class="large-4 columns sidebar">
	<?php dynamic_sidebar(); ?>
</div>
```

قمنا باستبدال النصّ الموجود مسبقاً "Sidebar" بدالّة [`dynamic_sidebar()`](http://codex.wordpress.org/Function_Reference/dynamic_sidebar) التي وظيفتها عرض محتويات الشريط الجانبي في المكان المحدد.

![صورة من القالب عند عرض الشريط الجانبي دون إعدادات](https://i.imgur.com/cCilwUY.png)


يمكن أن نمرّر قيمة واحدة لتلك الدالّة إما أن تكون اسم (name) أو معرّف (ID) الشريط الجانبي. وفي حال عدم تمرير أي قيمة يتم عرض الشريط الجانبي الأول.

## تخصيص الشريط الجانبي

كما لاحظنا فشكل ودجات الشريط الجانبي غير مقبولة، لنقم معاً بتحسين مظهرها عن طريق إحاطة كل واحدة من الودجات (widgets) بوسم `<div class="card">` الذي كان موجوداً في ملف `sidebar.php` قبل استخدام دالّة عرض الشريط الجانبي.

لنقم باستخدام إعدادات دالّة `register_sidebar()` التي مرّت معنا في الفقرات السابقة، في ملف `functions.php` نقوم بتعديل الدالّة لتصبح:
```php
register_sidebar(['before_widget' => '<div class="card">', 'after_widget' => '</div>']);
```

قمنا بتمرير إعدادَين فقط لإضافة وسم `div` قبل واحدة من الودجات وإضافة إغلاق الوسم بعد كل واحدة منها.

![صورة للشريط الجانبي بعد إحاطة الودجات بوسم div مع صنف card](https://i.imgur.com/pcRAFh8.png?2)

بهذا نكون قد انتهينا من إضافة قائمة رئيسية وشريط جانبي إلى القالب، وتعلمنا معاً كيف يمكن تخصيص شكل القائمة والشريط الجانبي ليتناسب مع القالب بأفضل شكل ممكن.