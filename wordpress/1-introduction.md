[TOC]
# مقدمة في التطوير لووردبريس

هل صنعت قالب HTML وأحببته لكنك لم تعرف كيف تحوّله إلى قالب ووردبريس؟ ليس بعد الآن، ستتعلم في هذه السلسلة إن شاء الله كيف تقوم بذلك.

هل تدري أن هناك الكثير من المطوّرين يكسبون رزقهم عن طريق إنشاء قوالب وإضافات ووردبريس (WordPress) وبيعها؟

وهل تعلم أن مطوّري ووردبريس من الممكن أن يحصلوا على آلاف الدولارات سنوياً من خلال بيع منتجاتهم؟

سنتعرّف في هذه السلسلة إلى أساسيات ومبادئ التطوير لووردبريس، نتناول فيها القوالب والإضافات والأمور البرمجية المشتركة بينهما.

هذه السلسلة مخصصة لمطوّري الويب، على فرض أن القارئ على اطّلاع بسيط بما يتعّلق بلغة PHP وMySQL ومعلومات عامّة عن كيفية تنصيب واستخدام ووردبريس.

سنبدأ السلسلة بإنشاء قالبٍ بسيطٍ نتناول من خلاله أساسيات إنشاء القوالب، ثم نَنتقل إلى تطوير الإضافات.

## متطلبات التشغيل

نحتاج إلى تحميل نسخة ووردبريس من الموقع الرسمي (http://wordpress.org)، سنستخدم النسخة العربية من هذا الرابط: http://ar.wordpress.org.

تحتاج ووردبريس إلى خادوم ويب، سواء كان Apache أو Nginx أو الخادوم المدمج مع لغة PHP (بإصدار5.4 وما فوق). وتحتاج أيضاً إلى خادوم قواعد البيانات MySQL.

لنقم معاً بإنشاء مجلد جديد هو `wordpress_tutorials` ونضع فيه نسخة ووردبريس الناتجة عن فكّ ضغط الملف الذي قمنا بتحميله.

**ملاحظة:** يمكن أن تستخدم البرامج المجهزة خصيصاً بخوادم Apache و MySQL مثل MAMP، WAMP أو XAMPP. مع مراعاة الاختلاف بين رابط خادوم الويب ومعلومات خادوم MySQL مع ما سنستخدمه في هذه السلسلة.

سنقوم باستخدام الخادوم المدمج مع PHP لاختصار تنصيب خادوم Apache أو Nginx وتجنب الدخول في الإعدادات الخاصة بكل واحد منهما.

لتشغيل الخادوم المدمج نتوجه من سطر اﻷوامر إلى المجلد الذي يحوي نسخة ووردبريس. ثم نكتب أمر:
```bash
php -S localhost:8000
```

يتم تشغيل خادوم الويب المدمج مع PHP على الحاسوب، يمكن التوجه عن طريق المتصفح إلى الرابط [localhost:8000](http://localhost:8000) للتأكد من أن الخادوم يعمل.


# تطوير القوالب

## مقدمة

سنقوم بالاعتماد على قالبٍ قمتُ بإعداده مسبقاً من أجل هذه السلسلة يمكن تحميله من [هذا الرابط](https://github.com/AAlakkad/Simple-Template/releases/download/v1.0.0/dist.zip)، التصميم هو قالب عادي يحوي بضع ملفات HTML و CSS و JavaScript. وهو مبني على إطار عمل Foundation مع بعض التعديلات والإضافات. محتواه فقط للتجريب ورؤية كيفية ظهور الشكل العامّ له.

نتوجه إلى مجلد المشروع الذي يحوي ملفات ووردبريس، منه نتوجه إلى مجلد `wp-content` ثم مجلد `themes`. نقوم بإنشاء مجلد اسمه `my_theme` بمثابة مجلد القالب الذي سنقوم بإنشاءه.

## ملفات القالب الأساسية

نحتاج إلى وجود ملفين على الأقل ضمن مجلد القالب الذي أنشأناه، هما:
- `style.css`
- `index.php`
 
وهذا أقل ما يجب وجوده في القالب ليكون قالباً صالحاً للعمل.

نتجه إلى صفحة تغيير القوالب من لوحة تحكم ووردبريس لنرى ما يشبه:

![صفحة القوالب](https://i.imgur.com/Rlk7oDD.png)

كما تلاحظون لا نرى القالب الجديد الذي أنشأناه ضمن القوالب، وذلك ﻷن هناك شئياً آخيراً علينا فعله قبل أن نرى القالب الجديد في هذه الصفحة.

نحتاج إلى وضع تعليق في ملف `style.css` كالتالي (يمكن تعديل أي قيمة أيضاً):
```css
/*
Theme Name: قالبي الجديد
Author: عمار العقاد
Author URI: http://aalakkad.me
Description: قالب جديد، نقوم من خلاله بالتدرب على إنشاء قوالب WordPress.
Version: 1.0
*/
```
تقوم ووردبريس بالدخول إلى كل مجلد في مجلد القوالب، ثم تبحث عن ملف `style.css` بداخله تعليق يشبه التعليق السابق، ثم تقوم بتفسير هذه التعليقات ووضعها في صفحة القوالب التي يرى المستخدم من خلالها أسماء وتوصيف القوالب. وهناك تفصيلات أخرى للتعليقات في ملف `style.css` يمكن أن نتطرّق إليها فيها فيما بعد.

يمكن التوجه إلى صفحة القوالب من خلال لوحة التحكم، لنرى شيئاً مشابهاً لما يلي:

![صفحة القوالب بعد إضافة القالب الجديد](https://i.imgur.com/dMEFIqY.png)

لنقم بتفعيل هذا القالب الجديد، ثم نتوجه إلى الصفحة الرئيسية للمدونة (الصفحة التي تُظهر المقالات وليست صفحة لوحة التحكم). إن كنت تستخدم الخادوم المدمج مع PHP بالطريقة التي ذكرناها، فيكون رابط الصفحة الرئيسية هو: [localhost:8000](http://localhost:8000).
سنرى صفحة بيضاء دون أن تحوي أي شيء، وذلك ﻷن القالب ما زال فارغاً تماماً.

لا تقلقوا سنقوم بملئه في تتمه السلسلة، لن يبقى هكذا :)

## نقل قالب HTML إلى قالب ووردبريس

ما سنفعله في الخطوة الأولى هو وضع قالب HTML في ملف `index.php` ثم نقوم بتعديل مسارات ملفات CSS و JavaScript.


ستكون جميع الصفحات التي نستخدمها من ووردبريس بعد تفعيل القالب الجديد متطابقة، وكأنها قالب HTML نفسه. وهذا هو المطلوب في هذه المرحلة، سنقوم بإضافة التفاصيل فيما بعد وعلى عدة مراحل.

نقوم الآن بنسخ محتوى ملف `index.html` كاملاً من قالب HTML ونضعه في ملف `index.php` في قالبنا الجديد `my_theme` ضمن ووردبريس.
ثم ننسخ مجلد `assets` كما هو إلى داخل مجلد قالبنا الجديد.

لنرى كيف أصبح شكل الموقع بعد أن وضعنا محتوى ملف `index.html`  في ملف `index.php`:

![صورة من للقالب](https://i.imgur.com/k5etRK4.png)

لا تقلقوا، يظهر القالب بهذا الشكل ﻷن ملفات CSS وJavaScript أصبحت في مسار مختلف عن المسار الذي كان موجوداً في قالب HTML.

علينا الآن أن نقوم بتعديل مسارات هذه الملفات كي يصبح شكل قالب ووردبريس الجديد مطابقاً لشكل قالب HTML.

توفر لنا ووردبريس عدداً من الدّوالّ (functions) مهمتها تسهيل إنشاء القوالب، سنستخدم منها `get_template_directory_uri()`، تقوم هذه الدالّة بإرجاع قيمة نصّيّة هي رابط القالب.

مثلاً، إن كان مجلد القالب هو `my_theme` ورابط خادوم الويب الذي نعمل عليه هو `http://localhost:8000` ستكون نتيجة الدالّة هي:

> http://localhost:8000/wp-content/my_theme

يجب أن نستخدم هذه الدالّة أو ما يشابهها لنحصل على الروابط، ولا نستخدمُ روابط نضعها بشكل يدوي، فرابط خادوم الويب يمكن أن يتغير، وإن كانت الروابط موضوعةً بشكل يدوي سيظهر شكل القالب كما في الأعلى خالياً من ملفات CSS و JavaScript صالحة.

نقوم بتعديل ملف index.html في قسم head، نبحث عن سطر استدعاء ملفات CSS، ثم نقوم بالتعديل عليها لتصبح بالشكل:

```html
<link rel="stylesheet" href="<?php echo get_template_directory_uri();?>/assets/css/main.css">
```

في قسم head أيضاً نريد استبدال رابط استدعاء ملف `modernizr.js` ليستخدم دالّة `get_template_directory()`، فيصبح:

```html
<script src="<?php echo get_template_directory_uri(); ?>/assets/js/modernizr.js"></script>
```

أخيراً نبحث في نهاية ملف `index.php` عن سطر استدعاء ملف JavaScript، ونقوم بالتعديل عليه ليصبح كما يلي:

```html
<script src="<?php echo get_template_directory_uri(); ?>/assets/js/vendor.js"></script>
```

الآن عندما يتم طلب المدونة من المتصفح، ستكون النتيجة النهائية للتعديلات الثلاثة التي قمنها بها كالتالي:
```html
<link rel="stylesheet" href="http://localhost:8000/wp-content/themes/my_theme/assets/css/main.css">

<script src="http://localhost:8000/wp-content/themes/my_theme/assets/js/modernizr.js"></script>

<script src="http://localhost:8000/wp-content/themes/my_theme/assets/js/vendor.js"></script>
```

نذهب الآن إلى الصفحة الرئيسية للمدونة لنرى كيف أصبح القالب.

![صورة قالب ووردبريس الجديد](https://i.imgur.com/coKd63S.png)


في آخر فقرة من هذا الدرس سنقوم بتعديل ترويسة الموقع التي نصّها الحالي هو: "عنوان الموقع"، والذي يظهر في الجُزء العُلويّ. نريد تغيير هذا النصّ ليصبح اسم المدونة التي قمنا بإدخالها أثناء مرحلة التنصيب، يمكنك تغيير اسم المدونة من لوحة التحكم ثم الإعدادات.

لنفتح صفحة `index.php` في المحرر، ثم نبحث عن السطر الذي يحوي:
```html
<h1 class="logo">عنون الموقع</h1>
```
,نقوم باستبداله بما يلي بعض إضافة وسم PHP له:
```php
<h1 class="logo"><?php bloginfo('name'); ?></h1>
```

وسم
```php
<?php php bloginfo('name'); ?>
```
يقوم بإظهار/طباعة نصّ يتم جلبه من قاعدة البيانات، النصّ هو اسم المدونة. نلاحظ أن الدّالّة `bloginfo` تقوم بالإظهار وليست الإرجاع `return` كما تفعل دالّة `get_template_directory_uri()`.

الآن عندما نتوجّه إلى الصفحة الرئيسية للمدونة تكون الترويسة شبيهة بالصورة:

![القالب بعد إظهار اسم المدونة](http://i.imgur.com/ycISB97.png)

## فصل محتوى الملفات

من قواعد البرمجة الهامة هي إلغاء الترابط أو الفصل (decoupling)، فنحاول فصل العناصر المترابطة قدر الإمكان ووضعها في ملفات منفصلة.

مثلاً سنقوم لاحقاً بإنشاء صفحة خاصّة لعرض المواضيع المنفردة، وستحتاج تلك الصفحة إلى وجود الترويسة (header) والتذييل (footer) كي تحوي ملفات CSS و JavaScript وتكون متناغمة مع باقي القالب.

توفّر لنا ووردبريس عدة طرق لإلغاء الترابط في الملفات، إما أن يتم استخدام التسلسل الهرمي لملفات القالب (theme hierarchy) أو يتم استخدام قِطَع القالب (template parts).

سنقوم باستخدام التسلسل الهرمي الآن، ونتعرّض لشرح قِطَع القالب في وقت لاحق. 

إن كانت التسميات تزعجك وتراها غير مفهومة لا تقلق، ستكون واضحة جداً بعد أن نبدأ :)

سنقوم بإنشاء 3 ملفات في القالب هي:
- header.php
- footer.php
- sidebar.php

ومن ثم يمكننا استخدام هذه الملفات في أي مكان ضمن القالب عن طريق الدوالّ:
- `get_header()`
- `get_footer()`
- `get_sidebar()`

هذه الدوالّ تعمل بشكل مشابه لـ `require` التي نعرفها في لغة PHP.

بهذه الطريقة لن نحتاج إلى القيام بالنسخ واللصق في كل مرة نريد إدراج الترويسة في ملفات القالب، وفي حال أردنا تعديل شيء في الترويسة فلن نضطر إلى تطبيق التعديل في جميع ملفات القالب.

الخطوة التالية هي نقل المحتوى المناسب لكل ملفّ من الملفّات السابقة من ملف `index.php` إلى الملفات الثلاثة الجديدة التي أنشأناها.

سنقوم حرفياً بالنسخ واللصق من ملف `index.php` إلى الملفات الثلاثة، ثم نقوم بوضع إحدى الدّوالّ الثلاثة في ملف `index.php` بدل النصّ الذي قمنا باقتصاصه.

### ملف الترويسة header.php

نقوم باقتصاص محتوى ملف `index.php` من بدايته وحتى نهاية وسم `</header>` في السطر *57*. نضع ما اقتصصناه في ملف `header.php`. ثم نضع مكان الاقتصاص في ملف `index.php` ما يلي:
```php
<?php
get_header();
?>
```

فتصبح بداية ملف `index.php` مشابهةً لما يلي:
```php
<?php
get_header();
?>

	<div class="main-content">
		<div class="row">
```

نقوم بحفظ التعديلات على الملفَين ونتأكد من أن شيئاً لم يتغير أثناء تصفح الموقع.

### ملف التذييل footer.php
نقوم الآن باقتصاص الجزء الخاص بالتذييل من ملف `index.php`، في السطر `71` بدءاً من وسم:
```html
<div class="site-footer">
```
وحتى نهاية الملف.

نقوم بوضع المحتوى في ملف `footer.php`، ثم نستبدل مكان الوسوم المقصوصة في ملف `index.php` بما يلي:
```php
<?php
get_footer();
?>

```
### ملف الشريط الجانبي sidebar.php

الوسوم الخاصّة بالشريط الجانبي ما هي إلا أربعة أسطر، تبدأ من السطر `64`، المحتوى هو:
```html
<div class="large-4 columns sidebar">
    <div class="card">
        Sidebar
    </div>
</div>
```

نقوم بنقل المحتوى السابق من ملف `index.php` إلى ملف `sidebar.php`، ونضع مكانه في ملف `index.php`:
```php
<?php
get_sidebar();
?>
```

بهذا ننتهي من المرحلة الأولى من إلغاء الترابط بين الوسوم، وضعنا كل جزءٍ منها في ملفٍّ خاصٍّ به، وكلما أردنا استخدام ذلك الجزء نقوم باستدعاء الدّالّة المناسبة لذلك.

أصبح ملف `index.php` أقصر في الحجم، ويؤدّي نفس الغرض الذي كان يؤدّيه قبل أن نقوم بالتعديلات، محتوى الملف كالتالي:
```php
<?php
get_header();
?>
	<div class="main-content">
		<div class="row">
			<div class="large-8 right columns news">
				<div class="row">
					<div class="medium-12 columns">
						<article class="card">
							<header>
								<h1>Post title</h1>
							</header>
							<div class="date">4 كانون الأول 2014</div>

							<p>خلافاَ للاعتقاد <a href="#">السائد</a> فإن لوريم إيبسوم ليس نصاَ عشوائياً، بنذ العام 45 قبل الميلاد، مما يجعله أكثر من 2000 عام في القدم. قام البروفيسور "ريتشارد ماك لينتوك" (Richard McClintock) وهو بروفيسور اللغة اللاتينية في جامعة هامبدن-سيدني في فيرجينيا بالبحث عن أصول كلمة لاتينية غامضة في نص لوريم إيبسوم وهي "consectetur"، وخلال تتبعه لهذه الكلمة في الأدب اللاتيني اكتشف المصدر الغير قابل للشك. فلقد اتضح أن كلمات نص لوريم إيبسوم تأتي من الأقسام 1.10.32 و 1.10.33 من كتاب "حول أقاصي الخير والشر" (de Finibus Bonorum et Malorum) للمفكر شيشيرون (Cicero) والذي كتبه في عام 45 قبل الميلاد. هذا الكتاب هو بمثابة مقالة علمية مطولة في نظرية الأخلاق، وكان له شعبية كبيرة في عصر النهضة. السطر الأول من لوريم إيبسوم "Lorem ipsum dolor sit amet.." يأتي من سطر في القسم 1.20.32 من هذا الكتاب.</p>

							<div class="read-more text-left">
								<a href="#">تابع قراءة المقال &raquo;</a>
							</div>

							<footer class="tags">
								<span class="label">تقني</span>
								<span class="label">تنمية</span>
								<span class="label">منوعات</span>
							</footer>
						</article>
					</div>
					<div class="medium-12 columns">
						<article class="card">
							<header>
								<h1>Post title</h1>
							</header>
							<div class="date">4 كانون الأول 2014</div>

							<p>خلافاَ للاعتقاد <a href="#">السائد</a> فإن لوريم إيبسوم ليس نصاَ عشوائياً، بنذ العام 45 قبل الميلاد، مما يجعله أكثر من 2000 عام في القدم. قام البروفيسور "ريتشارد ماك لينتوك" (Richard McClintock) وهو بروفيسور اللغة اللاتينية في جامعة هامبدن-سيدني في فيرجينيا بالبحث عن أصول كلمة لاتينية غامضة في نص لوريم إيبسوم وهي "consectetur"، وخلال تتبعه لهذه الكلمة في الأدب اللاتيني اكتشف المصدر الغير قابل للشك. فلقد اتضح أن كلمات نص لوريم إيبسوم تأتي من الأقسام 1.10.32 و 1.10.33 من كتاب "حول أقاصي الخير والشر" (de Finibus Bonorum et Malorum) للمفكر شيشيرون (Cicero) والذي كتبه في عام 45 قبل الميلاد. هذا الكتاب هو بمثابة مقالة علمية مطولة في نظرية الأخلاق، وكان له شعبية كبيرة في عصر النهضة. السطر الأول من لوريم إيبسوم "Lorem ipsum dolor sit amet.." يأتي من سطر في القسم 1.20.32 من هذا الكتاب.</p>

							<div class="read-more text-left">
								<a href="#">تابع قراءة المقال &raquo;</a>
							</div>

							<footer class="tags">
								<span class="label">تقني</span>
								<span class="label">تنمية</span>
							</footer>
						</article>
					</div>
				</div>
				<div class="row">
					<div class="medium-12 columns">
						<ul class="pagination">
							<li class="arrow unavailable"><a href="">&laquo;</a></li>
							<li class="current"><a href="">1</a></li>
							<li><a href="">2</a></li>
							<li><a href="">3</a></li>
							<li><a href="">4</a></li>
							<li class="unavailable"><a href="">&hellip;</a></li>
							<li><a href="">12</a></li>
							<li><a href="">13</a></li>
							<li class="arrow"><a href="">&raquo;</a></li>
						</ul>
					</div>
				</div>
            </div>
            <?php
            get_sidebar();
            ?>
		</div>
	</div>
<?php
get_footer();
?>

```

---
تعلّمنا في هذا الدرس كيف نقوم بتجهيز قالب HTML ليُصبح قالبَ ووردبريس، وكيف نعدّل مسارات ملفات JavaScript وCSS لتصبح متناغمةً مع رابط الويب الخاص بقالب ووردبريس.
وفي القسم الآخر من الدرس تعلّمنا كيف نقوم بفصل المحتوى عن ملف `index.php` إلى ملفّات فرعية أخرى، لنقوم بإعادة استخدامها في أي ملف ضمن القالب.

في الدرس القادم من السلسلة، سنقوم باستبدال النصوص الثابتة الموجودة حالياً في القالب بنصوصٍ من قاعدة البيانات، وسنجلب المقالات التي يتم إدخالها من لوحة التحكم لنعرضها في الصفحة الرئيسية.